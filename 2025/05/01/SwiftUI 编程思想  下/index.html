<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="《SwiftUI编程思想》 onevcat  第一版笔记  下">
<meta property="og:type" content="article">
<meta property="og:title" content="SwiftUI 编程思想 下">
<meta property="og:url" content="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2025/05/01/SwiftUI%20%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%20%20%E4%B8%8B/index.html">
<meta property="og:site_name" content="学计算机的那个">
<meta property="og:description" content="《SwiftUI编程思想》 onevcat  第一版笔记  下">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/res/swiftui_animation_fun.png">
<meta property="article:published_time" content="2025-04-30T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-03T03:50:27.222Z">
<meta property="article:author" content="Jack Chen">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/res/swiftui_animation_fun.png">

<link rel="canonical" href="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2025/05/01/SwiftUI%20%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%20%20%E4%B8%8B/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SwiftUI 编程思想 下 | 学计算机的那个</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">学计算机的那个</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">不是我觉到、悟到，你给不了我，给了也拿不住;只有我觉到、悟到，才有可能做到，能做到的才是我的.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2025/05/01/SwiftUI%20%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%20%20%E4%B8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jack Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学计算机的那个">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SwiftUI 编程思想 下
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-05-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-05-01T00:00:00+08:00">2025-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-05-03 11:50:27" itemprop="dateModified" datetime="2025-05-03T11:50:27+08:00">2025-05-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/SwiftUI/" itemprop="url" rel="index"><span itemprop="name">SwiftUI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>《SwiftUI编程思想》 onevcat  第一版笔记  下</p>
<span id="more"></span>

<h1 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h1><h2 id="隐式动画"><a href="#隐式动画" class="headerlink" title="隐式动画"></a>隐式动画</h2><p>隐式动画是 view 树的一部分：通过为 view 添加 <code>.animation</code> 修饰器，任何对这个 view 的改变都会自动进行动画。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="meta">@State</span> <span class="keyword">var</span> selected: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">	<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">		<span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.selected.toggle() &#125;) &#123;</span><br><span class="line">		<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">10</span>)</span><br><span class="line">		.fill(selected <span class="operator">?</span> <span class="type">Color</span>.red : .green)</span><br><span class="line">		.frame(width: selected <span class="operator">?</span> <span class="number">100</span> : <span class="number">50</span>, height: selected <span class="operator">?</span> <span class="number">100</span> : <span class="number">50</span>)</span><br><span class="line">		&#125;.animation(.default)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以这种方式所创建的动画感觉上有一点像 Apple 的 “Keynote 演讲” 程序里的神奇移动 (Magic Move)：我们定义初始点和结束点，程序来决定要怎么在两者之间进行动画。</p>
</blockquote>
<p>和其他 view 更新的机制一样，动画也只会在状态改变时被触发,当我们为 view 树添加一个像是 <code>.animation(.default) </code>的修饰器时，SwiftUI 将在 view 更新的时候以动画的方式把旧的 view 树改变为新的 view 树。</p>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>构建一个类似 iOS 内建的活动指示器 (activity indicator) 那样的，一个图片一直旋转的 view</p>
<p>首先，我们需要一些可以更改的状态以触发动画，这里我们使用一个布尔属性，当 view 出现时，我们将它设为 true</p>
<p>其次，我们需要通过在线性动画中加上 repeatForever，来让动画无限次重复</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LoadingIndicator</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> animating <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">	<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">		<span class="type">Image</span>(systemName: <span class="string">&quot;rays&quot;</span>)</span><br><span class="line">		.rotationEffect(animating <span class="operator">?</span> <span class="type">Angle</span>.degrees(<span class="number">360</span>) : .zero)</span><br><span class="line">		.animation(<span class="type">Animation</span></span><br><span class="line">		.linear(duration: <span class="number">2</span>)</span><br><span class="line">		.repeatForever(autoreverses: <span class="literal">false</span>)</span><br><span class="line">		)</span><br><span class="line">		.onAppear &#123; <span class="keyword">self</span>.animating <span class="operator">=</span> <span class="literal">true</span> &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>动画是由状态变更所驱动的</p>
</blockquote>
<h3 id="过渡"><a href="#过渡" class="headerlink" title="过渡"></a>过渡</h3><p>想要以动画的方式插入一个新 view，或者是移除一个已经存在的 view。SwiftUI为此准备了特定的方式，那就是过渡 (transition)</p>
<h4 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h4><p>下面是一个使用滑入滑出动画来将矩形移入和移出屏幕的过渡。当矩形被插入到 view 树中时，它从左侧动画滑入，当它被移出view 树时，它向右侧动画滑出：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="meta">@State</span> <span class="keyword">var</span> visible <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">	<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">		<span class="type">VStack</span> &#123;</span><br><span class="line">		<span class="type">Button</span>(<span class="string">&quot;Toggle&quot;</span>) &#123; <span class="keyword">self</span>.visible.toggle() &#125;</span><br><span class="line">			<span class="keyword">if</span> visible &#123;</span><br><span class="line">				<span class="type">Rectangle</span>()</span><br><span class="line">				.fill(<span class="type">Color</span>.blue)</span><br><span class="line">				.frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">				.transition(.slide)</span><br><span class="line">				.animation(.default)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，过渡效果 (.transition 修饰器) 本身并不进行动画，我们依然需要为它们开启动画。和之前一样，我们使用 <code>.animation(.default)</code> 来达成这一点。</p>
<h2 id="动画是如何工作的"><a href="#动画是如何工作的" class="headerlink" title="动画是如何工作的"></a>动画是如何工作的</h2><p>考察圆角矩形的动画，这次我们只对它的宽度进行动画。我们也会将动画的持续时间改成五秒，并让它按照线性方式进行动画：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">AnimatedButton</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> selected: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: &#123; <span class="keyword">self</span>.selected.toggle() &#125;) &#123;</span><br><span class="line">            <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">10</span>)</span><br><span class="line">                .fill(<span class="type">Color</span>.green)</span><br><span class="line">                .frame(width: selected <span class="operator">?</span> <span class="number">100</span> : <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">        &#125;.animation(.linear(duration: <span class="number">5</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在动画期间内，SwiftUI 对 width 值的计算分为两部分。<br>首先，SwiftUI 使用我们指定的Animation 值 (在上面的例子中，这个值是 .linear)来计算动画的进度。确定了动画的进度，SwiftUI 就可以对被变更的属性在起始值和终止值之间进行插值了。</p>
<blockquote>
<p>通常，动画的进度是间于 0 和 1 之间的一个值，0 代表动画的开始，1 代表动画的结束 (不过，有一些动画可以带有“弹性”，它们的进度值有可能会大于 1 或者小于 0)</p>
</blockquote>
<p>为了对值进行动画，SwiftUI 使用了 Animatable 协议，该协议仅具有一个要求：一个类型遵守<code>VectorArithmetic</code> 协议的 <code>animatableData</code> 属性。</p>
<p>VectorArithmetic 类型可以进行加法和减法运算，也可以使用 Double 进行乘法。通过这些运算，SwiftUI 可以得出动画的起始值和终止值之间的差值，并将它乘以当前的进度值来得到实际需要的插值。</p>
<p>以矩形 width 动画从 50 到100 为例，SwiftUI 通过 <code>50 + (100 - 50) * progress</code> 就可以计算出当前的宽度。或者，当从绿色动画到红色时，我们可以将它写作 <code>.green + (.red - .green) * progress</code></p>
<p>一般而言，SwiftUI 将<code>animatableData</code> 属性的当前值计算为 <code>startValue + (endValue - startValue) * progress</code></p>
<p>当为一个 view 的子树设定隐式动画 (比如 .animation(.default)) 时，子树上的所有可动画属性都会被加上动画，我们也可以通过调用 .animation(nil) 来在这棵子树上禁用所有动画 (甚至包括那些显式动画)。</p>
<h3 id="动画曲线"><a href="#动画曲线" class="headerlink" title="动画曲线"></a>动画曲线</h3><p><code>.linear(duration: 5)</code> 这个 Animation 值提供了一条动画曲线，它在五秒钟的<br>过程内将进度平均地从 0 到 1 进行插值。<br>.easeInOut(duration: 0.35) 来使用缓入&#x2F;缓出曲线 (ease-in&#x2F;ease-out curve)，它将一开始会缓慢移动，然后加快速度，最后再降低速度。</p>
<p>动画曲线可以被看作是一个函数，它接受时间作为输入，返回在这个时间点上对应的动画所达到的进度。下面是内置的动画曲线进行可视化后的样子。</p>
<p><img src="/./res/swiftui_animation_fun.png"></p>
<blockquote>
<p>横轴代表时间，纵轴代表动画进行的进度：</p>
</blockquote>
<p>可以通过一些修饰器来改变 Animation 的值。比如，我们可以调用 .speed(0.1) 来让动画速度减慢到十分之一，或者我们可以调用 .delay(2) 来让动画延后两秒。另外，repeatCount 是一个很有意思的修饰器，它可以让我们重复一个动画若干次</p>
<h2 id="显示动画"><a href="#显示动画" class="headerlink" title="显示动画"></a>显示动画</h2><p>下面这个另一版本的加载指示器，它将一个小原点沿着圆圈进行动画：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LoadingIndicator</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="meta">@State</span> <span class="keyword">var</span> appeared <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">	<span class="keyword">let</span> animation <span class="operator">=</span> <span class="type">Animation</span></span><br><span class="line">	.linear(duration: <span class="number">2</span>)</span><br><span class="line">	.repeatForever(autoreverses: <span class="literal">false</span>)</span><br><span class="line">		<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">			<span class="type">Circle</span>()</span><br><span class="line">			.fill(<span class="type">Color</span>.accentColor)</span><br><span class="line">			.frame(width: <span class="number">5</span>, height: <span class="number">5</span>)</span><br><span class="line">			.offset(y: <span class="operator">-</span><span class="number">20</span>)</span><br><span class="line">			.rotationEffect(appeared <span class="operator">?</span> <span class="type">Angle</span>.degrees(<span class="number">360</span>) : .zero)</span><br><span class="line">			.animation(animation)</span><br><span class="line">			.onAppear &#123; <span class="keyword">self</span>.appeared <span class="operator">=</span> <span class="literal">true</span> &#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们旋转模拟器(或者设备) 时，这个点将会在一条奇怪的路径上运动：因为我们使用了隐式动画，SwiftUI 也将会为点的 frame 改变进行这个永不停止的动画 (这个 frame 改变是由设备转向所造成的)。</p>
<p>只想为那些 view 树中由于 self.appeared 状态属性变更所造成的变化进行动画。要做到这一点，我们将隐式动画移除，并将状态改变的代码包装到一个 withAnimation (显式动画) 调用中：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Circle</span>()</span><br><span class="line">.fill(<span class="type">Color</span>.accentColor)</span><br><span class="line">.frame(width: <span class="number">5</span>, height: <span class="number">5</span>)</span><br><span class="line">.offset(y: <span class="operator">-</span><span class="number">20</span>)</span><br><span class="line">.rotationEffect(appeared <span class="operator">?</span> <span class="type">Angle</span>.degrees(<span class="number">360</span>) : .zero)</span><br><span class="line">.onAppear &#123;</span><br><span class="line">withAnimation(<span class="keyword">self</span>.animation) &#123;</span><br><span class="line"><span class="keyword">self</span>.appeared <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义动画"><a href="#自定义动画" class="headerlink" title="自定义动画"></a>自定义动画</h2><p>有时候，实现自定义的可动画 view 修饰器是达成某些特定动画的唯一途径</p>
<h3 id="demo-2"><a href="#demo-2" class="headerlink" title="demo"></a>demo</h3><p>我们想要实现一个可以摇晃 view 来吸引用户注意的动画。当动画开始时，view 应该从它的初始位置向右移动，然后向左移动到初始位置的左侧，最后在移动回到初始位置。</p>
<p>要实现这个动画，我们可以实现我们自己的自定义 view 修饰器，并使它遵守 <code>AnimatableModifier</code> 协议 (这个协议继承自 <code>Animatable</code> 和 <code>ViewModifier</code>)。我们的修饰器有一个 times 属性，当它增加时，就将晃动 view。我们的目标是当这个属性被增加 1 时，晃动一次 view，当增加 2 时晃动两次，以此类推：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Shake</span>: <span class="title class_">AnimatableModifier</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> times: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">let</span> amplitude: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">	<span class="keyword">var</span> animatableData: <span class="type">CGFloat</span> &#123;</span><br><span class="line">		<span class="keyword">get</span> &#123; times &#125;</span><br><span class="line">		<span class="keyword">set</span> &#123; times <span class="operator">=</span> newValue &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> content.offset(x: sin(times <span class="operator">*</span> .pi <span class="operator">*</span> <span class="number">2</span>) <span class="operator">*</span> amplitude)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="keyword">func</span> <span class="title function_">shake</span>(<span class="params">times</span>: <span class="type">Int</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> modifier(<span class="type">Shake</span>(times: <span class="type">CGFloat</span>(times)))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> taps: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">		<span class="type">Button</span>(<span class="string">&quot;Hello&quot;</span>) &#123;</span><br><span class="line">			withAnimation(.linear(duration: <span class="number">0.5</span>)) &#123;</span><br><span class="line">				<span class="keyword">self</span>.taps <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		.shake(times: taps <span class="operator">*</span> <span class="number">3</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在body 的实现中，我们使用 sin 来为摇晃的动画设置一个平滑的曲线：如果 times 是一个整数，偏移量为 0。在整数之间的数字 (比如说 0 到 1 之间)，偏移量将从 0 动画变更到 10，然后变更到 -10，最后回到 0。</p>
<blockquote>
<p>如果需要暴露两个属性作为可动画属性，我们可以将它们包装在一个 AnimatablePair里。想要支持任意数量的属性，我们可以嵌套使用 AnimatablePair。</p>
</blockquote>
<blockquote>
<p>要验证 SwiftUI 在动画期间插入不同值的方式，我们可以在 animatableData 的 set-ter 或者 AnimatableModifier 的 body 中打印 log。</p>
</blockquote>
<p>当我们的动画修饰器需要进行动画的值可以被表示为仿射变换 (不论 2D 还是 3D) 时，我们也可以使用 GeometryEffect 来代替 AnimatableModifier。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ShakeEffect</span>: <span class="title class_">GeometryEffect</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> times: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">let</span> amplitude: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">	<span class="keyword">var</span> animatableData: <span class="type">CGFloat</span> &#123;</span><br><span class="line">		<span class="keyword">get</span> &#123; times &#125;</span><br><span class="line">		<span class="keyword">set</span> &#123; times <span class="operator">=</span> newValue &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">func</span> <span class="title function_">effectValue</span>(<span class="params">size</span>: <span class="type">CGSize</span>) -&gt; <span class="type">ProjectionTransform</span> &#123;</span><br><span class="line">		<span class="type">ProjectionTransform</span>(<span class="type">CGAffineTransform</span>(</span><br><span class="line">			translationX: sin(times <span class="operator">*</span> .pi <span class="operator">*</span> <span class="number">2</span>) <span class="operator">*</span> amplitude,</span><br><span class="line">			y: <span class="number">0</span></span><br><span class="line">		))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义过渡"><a href="#自定义过渡" class="headerlink" title="自定义过渡"></a>自定义过渡</h3><p>要自定义 view 的插入和移除动画，我们可以使用 AnyTransition 的 <code>modifier(active:identity:)</code>方法来创建自定义过渡。<br>这个方法接受两个 view 修饰器：一个用于过渡发生时，另一个用于过渡结束时。</p>
<p>当 view 被插入时，active 修饰器在插入开始时被应用到 view 上，然后向着 <code>identity</code> 修饰器所定义的状态进行迁移。</p>
<p>在移除过程中，动画反向进行：从 <code>identity</code> 修饰器开始，向 <code>active</code> 修饰器靠拢。</p>
<h3 id="demo-3"><a href="#demo-3" class="headerlink" title="demo"></a>demo</h3><p>创建一个模糊过滤。当 view 被插入时，它会以模糊状态出现，并且 opacity 值为零 (全透明)；当移除时，它会淡出并模糊。</p>
<p>第一步，我们创建一个自定义的 <code>ViewModifier</code>。当 active 是 true 时，内容是模糊且透明，当 active 为 false 时，模糊半径被设为 0，内容非透明：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Blur</span>: <span class="title class_">ViewModifier</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> active: <span class="type">Bool</span></span><br><span class="line">	<span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> content</span><br><span class="line">		.blur(radius: active <span class="operator">?</span> <span class="number">50</span> : <span class="number">0</span>)</span><br><span class="line">		.opacity(active <span class="operator">?</span> <span class="number">0</span> : <span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步，我们可以向 AnyTransition 添加一个静态属性，这可以帮助我们更容易访问到我们定义的新过渡：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">var</span> blur: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">	.modifier(active: <span class="type">Blur</span>(active: <span class="literal">true</span>),</span><br><span class="line">	identity: <span class="type">Blur</span>(active: <span class="literal">false</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，我们可以使用上面的例子，将 <code>.transition(.slide)</code> 替换成 <code>.transition(.blur)</code>。现在，在插入时，view 会从模糊状态淡入；而在它被移除时，会淡出到模糊状态。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/04/28/SwiftUI%20%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%20%20%E4%B8%AD/" rel="prev" title="SwiftUI 编程思想 中">
      <i class="fa fa-chevron-left"></i> SwiftUI 编程思想 中
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/05/08/SwiftUI%20%E4%B8%8ECombine%20%E4%B8%8A/" rel="next" title="SwiftUI 与 Combine 上">
      SwiftUI 与 Combine 上 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E7%94%BB"><span class="nav-number">1.</span> <span class="nav-text">动画</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%90%E5%BC%8F%E5%8A%A8%E7%94%BB"><span class="nav-number">1.1.</span> <span class="nav-text">隐式动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#demo"><span class="nav-number">1.1.1.</span> <span class="nav-text">demo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%B8%A1"><span class="nav-number">1.1.2.</span> <span class="nav-text">过渡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#demo-1"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">demo</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E7%94%BB%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="nav-number">1.2.</span> <span class="nav-text">动画是如何工作的</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E7%94%BB%E6%9B%B2%E7%BA%BF"><span class="nav-number">1.2.1.</span> <span class="nav-text">动画曲线</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%E5%8A%A8%E7%94%BB"><span class="nav-number">1.3.</span> <span class="nav-text">显示动画</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A8%E7%94%BB"><span class="nav-number">1.4.</span> <span class="nav-text">自定义动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#demo-2"><span class="nav-number">1.4.1.</span> <span class="nav-text">demo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%B8%A1"><span class="nav-number">1.4.2.</span> <span class="nav-text">自定义过渡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#demo-3"><span class="nav-number">1.4.3.</span> <span class="nav-text">demo</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jack Chen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">175</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Chen</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
