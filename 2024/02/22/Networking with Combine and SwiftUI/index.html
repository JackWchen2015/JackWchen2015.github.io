<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Getting StartedSwiftUIâ€™s reactive state management makes this a lot easier by introducing the notion of a source of truth that can be shared across your app using SwiftUIâ€™s property wrappers such as @">
<meta property="og:type" content="article">
<meta property="og:title" content="Networking with Combine and SwiftUI [è¯‘]">
<meta property="og:url" content="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2024/02/22/Networking%20with%20Combine%20and%20SwiftUI/index.html">
<meta property="og:site_name" content="å­¦è®¡ç®—æœºçš„é‚£ä¸ª">
<meta property="og:description" content="Getting StartedSwiftUIâ€™s reactive state management makes this a lot easier by introducing the notion of a source of truth that can be shared across your app using SwiftUIâ€™s property wrappers such as @">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-02-21T16:00:00.000Z">
<meta property="article:modified_time" content="2024-05-25T08:03:06.165Z">
<meta property="article:author" content="Jack Chen">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2024/02/22/Networking%20with%20Combine%20and%20SwiftUI/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Networking with Combine and SwiftUI [è¯‘] | å­¦è®¡ç®—æœºçš„é‚£ä¸ª</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">å­¦è®¡ç®—æœºçš„é‚£ä¸ª</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸æ˜¯æˆ‘è§‰åˆ°ã€æ‚Ÿåˆ°ï¼Œä½ ç»™ä¸äº†æˆ‘ï¼Œç»™äº†ä¹Ÿæ‹¿ä¸ä½;åªæœ‰æˆ‘è§‰åˆ°ã€æ‚Ÿåˆ°ï¼Œæ‰æœ‰å¯èƒ½åšåˆ°ï¼Œèƒ½åšåˆ°çš„æ‰æ˜¯æˆ‘çš„.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2024/02/22/Networking%20with%20Combine%20and%20SwiftUI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jack Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å­¦è®¡ç®—æœºçš„é‚£ä¸ª">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Networking with Combine and SwiftUI [è¯‘]
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-02-22 00:00:00" itemprop="dateCreated datePublished" datetime="2024-02-22T00:00:00+08:00">2024-02-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-25 16:03:06" itemprop="dateModified" datetime="2024-05-25T16:03:06+08:00">2024-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/SwiftUI/" itemprop="url" rel="index"><span itemprop="name">SwiftUI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><p>SwiftUIâ€™s reactive state management makes this a lot easier by introducing the notion of <code>a source of truth</code> that can be shared across your app using SwiftUIâ€™s property wrappers such as <code>@EnvironmentObject</code>, <code>@ObservedObject</code>, and <code>@StateObject</code></p>
<blockquote>
<p>the notion of a source of truth äº‹å®æº<br>This source of truth usually is your in-memory data model</p>
</blockquote>
<p>In this series, we will look at how to use Combine in the context of SwiftUI to</p>
<ul>
<li>access the network,</li>
<li>map data,</li>
<li>handle errors</li>
</ul>
<span id="more"></span>

<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:8080/isUserNameAvailable?userName=sjobs HTTP/1.1</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">content-type: application/json; charset=utf-8</span><br><span class="line">content-length: 39</span><br><span class="line">connection: close</span><br><span class="line">date: Thu, 06 Jan 2022 16:09:08 GMT</span><br><span class="line"> </span><br><span class="line">&#123;&quot;isAvailable&quot;:false, &quot;userName&quot;:&quot;sjobs&quot;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="network-using-URLSession"><a href="#network-using-URLSession" class="headerlink" title="network using URLSession"></a>network using URLSession</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">checkUserNameAvailableOldSchool</span>(<span class="params">userName</span>: <span class="type">String</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Result</span>&lt;<span class="type">Bool</span>, <span class="type">NetworkError</span>&gt;) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;http://127.0.0.1:8080/isUserNameAvailable?userName=<span class="subst">\(userName)</span>&quot;</span>) <span class="keyword">else</span> &#123; <span class="number">2</span></span><br><span class="line">    completion(.failure(.invalidRequestError(<span class="string">&quot;URL invalid&quot;</span>)))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> task <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTask(with: url) &#123; data, response, error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> error <span class="operator">=</span> error &#123; <span class="number">3</span></span><br><span class="line">      completion(.failure(.transportError(error)))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> response <span class="operator">=</span> response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span>, <span class="operator">!</span>(<span class="number">200</span><span class="operator">...</span><span class="number">299</span>).contains(response.statusCode) &#123; <span class="number">4</span></span><br><span class="line">      completion(.failure(.serverError(statusCode: response.statusCode)))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> data <span class="operator">=</span> data <span class="keyword">else</span> &#123; <span class="number">5</span></span><br><span class="line">      completion(.failure(.noData))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> decoder <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">      <span class="keyword">let</span> userAvailableMessage <span class="operator">=</span> <span class="keyword">try</span> decoder.decode(<span class="type">UserNameAvailableMessage</span>.<span class="keyword">self</span>, from: data)</span><br><span class="line">      completion(.success(userAvailableMessage.isAvailable)) <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">      completion(.failure(.decodingError(error)))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  task.resume() <span class="number">6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>issues:</li>
</ul>
<ol>
<li>Itâ€™s not immediately clear what the happy path is - the only location that returns a successful result is pretty hidden (1), and developers who are new to using completion handlers might be confused by the fact that the happy path doesnâ€™t even use a <code>return</code> statement to deliver the result of the network call to the caller.</li>
<li>Error handling is scattered all over the place (2, 3, 4, 5).</li>
<li>There are several exit points, and itâ€™s easy to forget one of the <code>return</code> statements in the <code>if let</code> conditions.</li>
<li>Overall, it is hard to read and maintain, even if youâ€™re an experienced Swift developer.</li>
<li>Itâ€™s easy to forget you have to call <code>resume() </code>to actually perform the request (6). I am pretty sure most of us have been frantically looking for bugs, only to find out we forgot to actually kick off the request using resume. And yes, I think <code>resume</code> is not a great name for an API that is inteded to send the request.</li>
</ol>
<h2 id="fetch-data-using-Combine"><a href="#fetch-data-using-Combine" class="headerlink" title="fetch data using Combine"></a>fetch data using Combine</h2><p>When they introduced <code>Combine</code>, <strong>Apple added publishers for many of their own asynchronous APIs</strong>. This is great, as this makes it easier for us to use them in our own <code>Combine</code> pipelines.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">checkUserNameAvailable</span>(<span class="params">userName</span>: <span class="type">String</span>) -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Bool</span>, <span class="type">Never</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;http://127.0.0.1:8080/isUserNameAvailable?userName=<span class="subst">\(userName)</span>&quot;</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Just</span>(<span class="literal">false</span>).eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: url) <span class="number">1</span></span><br><span class="line">    .map &#123; data, response <span class="keyword">in</span> <span class="number">2</span></span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> decoder <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">        <span class="keyword">let</span> userAvailableMessage <span class="operator">=</span> <span class="keyword">try</span> decoder.decode(<span class="type">UserNameAvailableMessage</span>.<span class="keyword">self</span>, from: data)</span><br><span class="line">        <span class="keyword">return</span> userAvailableMessage.isAvailable <span class="number">3</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> <span class="number">4</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .replaceError(with: <span class="literal">false</span>) <span class="number">5</span></span><br><span class="line">    .eraseToAnyPublisher()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is a lot easier to read already, and (except for the guard statement that makes sure weâ€™ve got a valid URL) there is just one exit point.<br>Letâ€™s walk through the code step by step:     </p>
<ol>
<li>We use <code>dataTaskPublisher</code> to perform the request. This publisher is a one-shot publisher(ä¸€æ¬¡æ€§å‘å¸ƒè€…) and will emit an event once the requested data has arrived. Itâ€™s worth keeping in mind that <code>Combine publishers</code> donâ€™t perform any work if there is no <code>subscriber</code>. This means that <strong>this publisher will not perform any call to the given <code>URL</code> unless there is at least one subscriber</strong>. I will later show you how to connect this pipeline to the <code>UI</code> and make sure it gets called every time the user enters their preferred username.</li>
<li>Once the request returns, the publisher emits a value that contains both the data and the response . In this line, we use the map operator to transform this result. As you can see, we can reuse most of the data mapping code from the previous version of the code, except for a couple of small changes:</li>
<li>Instead of calling the completion closure, we can return a <code>Boolean</code> value to indicate whether the username is still available or not. This value will be passed down the <code>pipeline</code>.</li>
<li>In case the data mapping fails, we catch the <code>error</code> and just return false, which seems to be a good compromise.</li>
<li>We do the same for any errors that might occur when accessing the network. This is a simplification that we might need to revisit in the future.</li>
</ol>
<h2 id="do-better"><a href="#do-better" class="headerlink" title="do better"></a>do better</h2><p>Here are three changes that will make the code more linear and easier to reason about:</p>
<h3 id="Destructuring-tuples-using-key-paths-ä½¿ç”¨å…³é”®è·¯å¾„è§£æ„å…ƒç»„"><a href="#Destructuring-tuples-using-key-paths-ä½¿ç”¨å…³é”®è·¯å¾„è§£æ„å…ƒç»„" class="headerlink" title="Destructuring tuples using key paths(ä½¿ç”¨å…³é”®è·¯å¾„è§£æ„å…ƒç»„)"></a>Destructuring tuples using key paths(ä½¿ç”¨å…³é”®è·¯å¾„è§£æ„å…ƒç»„)</h3><p>æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦ä»å˜é‡ä¸­æå–ç‰¹å®šå±æ€§çš„æƒ…å†µã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ¥æ”¶åˆ°ä¸€ä¸ªå…ƒç»„ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬å‘é€çš„<code>URL</code>è¯·æ±‚çš„æ•°æ®å’Œå“åº”ã€‚ä¸‹é¢æ˜¯<code>URLSession</code>ä¸­å„è‡ªçš„å£°æ˜:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">DataTaskPublisher</span> : <span class="title class_">Publisher</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/// The kind of values published by this publisher.</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Output</span> <span class="operator">=</span> (data: <span class="type">Data</span>, response: <span class="type">URLResponse</span>)</span><br><span class="line">  <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Combine</code>æä¾›äº†<code>map</code>æ“ä½œç¬¦çš„é‡è½½ç‰ˆæœ¬ï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨é”®è·¯å¾„è§£æ„å…ƒç»„ï¼Œå¹¶åªè®¿é—®æˆ‘ä»¬å…³å¿ƒçš„å±æ€§:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: url)</span><br><span class="line">  .map(\.data)</span><br></pre></td></tr></table></figure>
<h3 id="Mapping-Data-more-easily"><a href="#Mapping-Data-more-easily" class="headerlink" title="Mapping Data more easily"></a>Mapping Data more easily</h3><p>ç”±äºæ˜ å°„æ•°æ®æ˜¯ä¸€é¡¹å¦‚æ­¤å¸¸è§çš„ä»»åŠ¡ï¼Œ<code>Combine</code>é™„å¸¦äº†ä¸“é—¨çš„æ“ä½œç¬¦<code>:decode (type:decoder:)</code>æ¥ç®€åŒ–æ­¤ä»»åŠ¡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: url)</span><br><span class="line">  .map(\.data)</span><br><span class="line">  .decode(type: <span class="type">UserNameAvailableMessage</span>.<span class="keyword">self</span>, decoder: <span class="type">JSONDecoder</span>())</span><br></pre></td></tr></table></figure>
<p>è¿™å°†è¿”å›æ¥è‡ªä¸Šæ¸¸å‘å¸ƒè€…(upstream publisher)çš„è§£ç æ•°æ®å€¼ï¼Œå¹¶å°†å…¶è§£ç ä¸º<code>UserNameAvailableMessage</code>å®ä¾‹ã€‚ </p>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨<code>map</code>æ“ä½œç¬¦æ¥è§£æ„<code>UserNameAvailableMessage</code>å¹¶è®¿é—®å®ƒçš„<code>isAvailable</code>å±æ€§:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: url)</span><br><span class="line">  .map(\.data)</span><br><span class="line">  .decode(type: <span class="type">UserNameAvailableMessage</span>.<span class="keyword">self</span>, decoder: <span class="type">JSONDecoder</span>())</span><br><span class="line">  .map(\.isAvailable)</span><br></pre></td></tr></table></figure>

<h3 id="Fetching-data-using-Combine-simplified"><a href="#Fetching-data-using-Combine-simplified" class="headerlink" title="Fetching data using Combine, simplified"></a>Fetching data using Combine, simplified</h3><p>æœ‰äº†è¿™äº›å˜åŒ–ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªæ˜“äºé˜…è¯»çš„ç®¡é“ç‰ˆæœ¬ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªçº¿æ€§æµ:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">checkUserNameAvailable</span>(<span class="params">userName</span>: <span class="type">String</span>) -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Bool</span>, <span class="type">Never</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;http://127.0.0.1:8080/isUserNameAvailable?userName=<span class="subst">\(userName)</span>&quot;</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Just</span>(<span class="literal">false</span>).eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: url)</span><br><span class="line">    .map(\.data)</span><br><span class="line">    .decode(type: <span class="type">UserNameAvailableMessage</span>.<span class="keyword">self</span>, decoder: <span class="type">JSONDecoder</span>())</span><br><span class="line">    .map(\.isAvailable)</span><br><span class="line">    .replaceError(with: <span class="literal">false</span>)</span><br><span class="line">    .eraseToAnyPublisher()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="How-to-connect-to-SwiftUI"><a href="#How-to-connect-to-SwiftUI" class="headerlink" title="How to connect to SwiftUI"></a>How to connect to SwiftUI</h2><p>æœ€åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨æˆ‘ä»¬å‡è®¾çš„æ³¨å†Œè¡¨å•(hypothetical sign up form)ä¸­é›†æˆè¿™ä¸ªæ–°çš„<code>Combine</code>ç®¡é“ã€‚ </p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„æ³¨å†Œè¡¨å•ï¼Œå®ƒåªåŒ…å«ä¸€ä¸ªç”¨æˆ·åå­—æ®µã€ä¸€ä¸ªæ˜¾ç¤ºæ¶ˆæ¯çš„æ–‡æœ¬æ ‡ç­¾å’Œä¸€ä¸ªæ³¨å†ŒæŒ‰é’®ã€‚åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›UIå…ƒç´ æ¥æä¾›å¯†ç å’Œå¯†ç ç¡®è®¤ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SignUpScreen</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">  <span class="meta">@StateObject</span> <span class="keyword">private</span> <span class="keyword">var</span> viewModel <span class="operator">=</span> <span class="type">SignUpScreenViewModel</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Form</span> &#123;</span><br><span class="line">      <span class="comment">// Username</span></span><br><span class="line">      <span class="type">Section</span> &#123;</span><br><span class="line">        <span class="type">TextField</span>(<span class="string">&quot;Username&quot;</span>, text: <span class="variable">$viewModel</span>.username)</span><br><span class="line">          .autocapitalization(.none)</span><br><span class="line">          .disableAutocorrection(<span class="literal">true</span>)</span><br><span class="line">      &#125; footer: &#123;</span><br><span class="line">        <span class="type">Text</span>(viewModel.usernameMessage)</span><br><span class="line">          .foregroundColor(.red)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// Submit button</span></span><br><span class="line">      <span class="type">Section</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;Sign up&quot;</span>) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;Signing up as <span class="subst">\(viewModel.username)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .disabled(<span class="operator">!</span>viewModel.isValid)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€æœ‰<code>UI</code>å…ƒç´ éƒ½è¿æ¥åˆ°ä¸€ä¸ªè§†å›¾æ¨¡å‹ï¼Œä»¥åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œå¹¶ä¿æŒè§†å›¾çš„æ•´æ´å’Œæ˜“è¯»:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SignUpScreenViewModel</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">  <span class="comment">// MARK: Input</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> username: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// MARK: Output</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> usernameMessage: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> isValid: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äº<code>@Published</code>å±æ€§æ˜¯Combine å‘å¸ƒè€…ï¼Œæˆ‘ä»¬å¯ä»¥è®¢é˜…å®ƒä»¬ï¼Œä»¥ä¾¿åœ¨å®ƒä»¬çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶æ¥æ”¶æ›´æ–°ã€‚è¿™å…è®¸æˆ‘ä»¬è°ƒç”¨ä¸Šé¢åˆ›å»ºçš„<code>checkUserNameAvailable</code>ç®¡é“ã€‚ </p>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„å‘å¸ƒè€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥é©±åŠ¨<code>UI</code>çš„å„ä¸ªéƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†éœ€è¦æ ¹æ®ç”¨æˆ·åæ˜¯å¦å¯ç”¨æ¥æ˜¾ç¤ºä¿¡æ¯ã€‚ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæƒ°æ€§è®¡ç®—å±æ€§ã€‚è¿™ç¡®ä¿äº†ç®¡é“åªåœ¨éœ€è¦æ—¶æ‰ä¼šè¢«è®¾ç½®ï¼Œå¹¶ä¸”ç®¡é“åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> isUsernameAvailablePublisher: <span class="type">AnyPublisher</span>&lt;<span class="type">Bool</span>, <span class="type">Never</span>&gt; <span class="operator">=</span> &#123;</span><br><span class="line">  <span class="variable">$username</span></span><br><span class="line">    .flatMap &#123; username <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>.authenticationService.checkUserNameAvailable(userName: username)</span><br><span class="line">    &#125;</span><br><span class="line">    .eraseToAnyPublisher()</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<p>è¦è°ƒç”¨å¦ä¸€ä¸ªç®¡é“å¹¶ä½¿ç”¨å…¶ç»“æœï¼Œå¯ä»¥ä½¿ç”¨<code>flatMap</code>æ“ä½œç¬¦ã€‚è¿™å°†æ¥å—æ¥è‡ªä¸Šæ¸¸å‘å¸ƒè€…çš„æ‰€æœ‰è¾“å…¥äº‹ä»¶(å³ï¼Œ<code>$username</code> publishedå±æ€§å‘å‡ºçš„å€¼)ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºæ–°çš„å‘å¸ƒè€…(åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå‘å¸ƒè€…<code>checkUserNameAvailable</code> in)ã€‚ </p>
<p>åœ¨ä¸‹ä¸€æ­¥ä¹Ÿæ˜¯æœ€åä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠ<code>isUsernameAvailablePublisher</code>çš„ç»“æœè¿æ¥åˆ°UIã€‚å¦‚æœæŸ¥çœ‹ä¸€ä¸‹è§†å›¾æ¨¡å‹ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°åœ¨è§†å›¾æ¨¡å‹çš„è¾“å‡ºéƒ¨åˆ†æœ‰ä¸¤ä¸ªå±æ€§:ä¸€ä¸ªç”¨äºä¸ç”¨æˆ·åç›¸å…³çš„ä»»ä½•æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªç”¨äºä¿å­˜è¡¨å•çš„æ€»ä½“éªŒè¯çŠ¶æ€(è¯·è®°ä½ï¼Œåœ¨å®é™…çš„æ³¨å†Œè¡¨å•ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦éªŒè¯å¯†ç å­—æ®µ)ã€‚ </p>
<p>Combineå‘å¸ƒè€…å¯ä»¥è¿æ¥åˆ°å¤šä¸ªè®¢é˜…è€…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†<code>isValid</code>å’Œ<code>usernameMessage</code>éƒ½è¿æ¥åˆ°<code>isUsernameAvailablePublisher</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SignUpScreenViewModel</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">  <span class="operator">...</span></span><br><span class="line">  <span class="keyword">init</span>() &#123;</span><br><span class="line">    isUsernameAvailablePublisher</span><br><span class="line">      .assign(to: <span class="operator">&amp;</span><span class="variable">$isValid</span>)</span><br><span class="line">    </span><br><span class="line">    isUsernameAvailablePublisher</span><br><span class="line">      .map &#123; <span class="variable">$0</span> <span class="operator">?</span> <span class="string">&quot;&quot;</span> : <span class="string">&quot;Username not available. Try a different one.&quot;</span>&#125;</span><br><span class="line">      .assign(to: <span class="operator">&amp;</span><span class="variable">$usernameMessage</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç”¨<code>isUsernameAvailablePublisher</code>ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥é©±åŠ¨è¡¨å•çš„æ•´ä½“<code>isValid</code>çŠ¶æ€(å®ƒå°†å¯ç”¨&#x2F;ç¦ç”¨<code>Submit</code>æŒ‰é’®)å’Œé”™è¯¯æ¶ˆæ¯æ ‡ç­¾(é€šçŸ¥ç”¨æˆ·ä»–ä»¬é€‰æ‹©çš„ç”¨æˆ·åæ˜¯å¦ä»ç„¶å¯ç”¨)ã€‚</p>
<h2 id="How-to-handle-Publishing-changes-from-background-threads-is-not-allowed"><a href="#How-to-handle-Publishing-changes-from-background-threads-is-not-allowed" class="headerlink" title="How to handle Publishing changes from background threads is not allowed"></a>How to handle Publishing changes from background threads is not allowed</h2><p>å½“ä½ è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œä½ ä¼šæ³¨æ„åˆ°å‡ ä¸ªé—®é¢˜: </p>
<ol>
<li>å¯¹äºæ‚¨é”®å…¥çš„æ¯ä¸ªå­—ç¬¦ï¼ŒAPIç«¯ç‚¹å°†è¢«è°ƒç”¨å‡ æ¬¡ </li>
<li>Xcodeå‘Šè¯‰ä½ ä¸åº”è¯¥ä»åå°çº¿ç¨‹æ›´æ–°<code>UI </code><br>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€é›†ä¸­æ·±å…¥æ¢è®¨è¿™äº›é—®é¢˜çš„åŸå› ï¼Œä½†ç°åœ¨ï¼Œè®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé”™è¯¯æ¶ˆæ¯:</li>
</ol>
<blockquote>
<p>[SwiftUI] Publishing changes from background threads is not allowed; make sure to publish values from the main thread (via operators like receive(on:)) on model updates.</p>
</blockquote>
<p>å‡ºç°æ­¤é”™è¯¯æ¶ˆæ¯çš„åŸå› æ˜¯<code>Combine</code>å°†åœ¨åå°çº¿ç¨‹ä¸Šæ‰§è¡Œç½‘ç»œè¯·æ±‚ã€‚å½“è¯·æ±‚å¾—åˆ°æ»¡è¶³æ—¶ï¼Œæˆ‘ä»¬å°†ç»“æœåˆ†é…ç»™è§†å›¾æ¨¡å‹ä¸Šå·²å‘å¸ƒçš„å±æ€§ä¹‹ä¸€ã€‚åè¿‡æ¥ï¼Œè¿™å°†æç¤ºSwiftUIæ›´æ–°UIâ€”â€”è¿™å°†å‘ç”Ÿåœ¨å‰å°çº¿ç¨‹ä¸Šã€‚ </p>
<p>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œæˆ‘ä»¬éœ€è¦æŒ‡ç¤º<code>Combine</code>åœ¨æ”¶åˆ°ç½‘ç»œè¯·æ±‚çš„ç»“æœååˆ‡æ¢åˆ°å‰å°çº¿ç¨‹ï¼Œä½¿ç”¨<code>receive(on:)</code>æ“ä½œç¬¦:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> isUsernameAvailablePublisher: <span class="type">AnyPublisher</span>&lt;<span class="type">Bool</span>, <span class="type">Never</span>&gt; <span class="operator">=</span> &#123;</span><br><span class="line">  <span class="variable">$username</span></span><br><span class="line">    .flatMap &#123; username -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Bool</span>, <span class="type">Never</span>&gt; <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>.authenticationService.checkUserNameAvailableNaive(userName: username)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">||&gt;</span>    .receive(on: <span class="type">DispatchQueue</span>.main)<span class="operator">&lt;||</span></span><br><span class="line">    .eraseToAnyPublisher()</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬åœ¨ä¸‹ä¸€é›†ä¸­è®¨è®ºç»„åˆè°ƒåº¦ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å°†æ›´æ·±å…¥åœ°ç ”ç©¶çº¿ç¨‹ã€‚</p>
<h1 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h1><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>Combine</code>è®¿é—®ç½‘ç»œï¼Œä»¥åŠå®ƒå¦‚ä½•ä½¿æ‚¨èƒ½å¤Ÿç¼–å†™æ¯”ç›¸åº”çš„å›è°ƒé©±åŠ¨çš„å¯¹åº”ä»£ç æ›´å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤çš„ç›´çº¿ä»£ç ã€‚ </p>
<p>æˆ‘ä»¬è¿˜å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨è§†å›¾æ¨¡å‹è¿æ¥ä¸€ä¸ªå‘<code>SwiftUI</code>å‘å‡ºç½‘ç»œè¯·æ±‚çš„<code>Combine</code>ç®¡é“ï¼Œå¹¶å°†è¯¥ç®¡é“é™„åŠ åˆ°<code>@Published</code>å±æ€§ã€‚ </p>
<p>ç°åœ¨ï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆ<code>isUsernameAvailablePublisher</code>ä½¿ç”¨<code>Never</code>ä½œä¸ºå…¶é”™è¯¯ç±»å‹â€”æ¯•ç«Ÿï¼Œç½‘ç»œé”™è¯¯æ˜¯æˆ‘ä»¬éå¸¸éœ€è¦å¤„ç†çš„äº‹æƒ…ã€‚ </p>
<p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€é›†ä¸­è®¨è®ºé”™è¯¯å¤„ç†(å’Œè‡ªå®šä¹‰æ•°æ®æ˜ å°„)ã€‚æˆ‘ä»¬è¿˜å°†æ¢è®¨ä¼˜åŒ–åŸºäº<code>Combine</code>çš„ç½‘ç»œå±‚çš„æ–¹æ³•ï¼Œæ•¬è¯·æœŸå¾…! </p>
<p>æ„Ÿè°¢é˜…è¯»ğŸ”¥</p>
<p>#å‚è€ƒ<br><a target="_blank" rel="noopener" href="https://peterfriese.dev/blog/2022/swiftui-combine-networking-gettingstarted/#how-to-connect-to-swiftui">Networking with Combine and SwiftUI</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/02/11/SwiftUI%20Concepts%20Tutorials%20%E7%AC%94%E8%AE%B0/" rel="prev" title="SwiftUI Concepts Tutorials ç¬”è®°">
      <i class="fa fa-chevron-left"></i> SwiftUI Concepts Tutorials ç¬”è®°
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/02/22/Combine%20%E3%80%90%E8%AF%91%E3%80%91/" rel="next" title="Combine [è¯‘]">
      Combine [è¯‘] <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Getting-Started"><span class="nav-number">1.</span> <span class="nav-text">Getting Started</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Demo"><span class="nav-number">2.</span> <span class="nav-text">Demo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#network-using-URLSession"><span class="nav-number">2.1.</span> <span class="nav-text">network using URLSession</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fetch-data-using-Combine"><span class="nav-number">2.2.</span> <span class="nav-text">fetch data using Combine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#do-better"><span class="nav-number">2.3.</span> <span class="nav-text">do better</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Destructuring-tuples-using-key-paths-%E4%BD%BF%E7%94%A8%E5%85%B3%E9%94%AE%E8%B7%AF%E5%BE%84%E8%A7%A3%E6%9E%84%E5%85%83%E7%BB%84"><span class="nav-number">2.3.1.</span> <span class="nav-text">Destructuring tuples using key paths(ä½¿ç”¨å…³é”®è·¯å¾„è§£æ„å…ƒç»„)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mapping-Data-more-easily"><span class="nav-number">2.3.2.</span> <span class="nav-text">Mapping Data more easily</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fetching-data-using-Combine-simplified"><span class="nav-number">2.3.3.</span> <span class="nav-text">Fetching data using Combine, simplified</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-connect-to-SwiftUI"><span class="nav-number">2.4.</span> <span class="nav-text">How to connect to SwiftUI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-handle-Publishing-changes-from-background-threads-is-not-allowed"><span class="nav-number">2.5.</span> <span class="nav-text">How to handle Publishing changes from background threads is not allowed</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Closure"><span class="nav-number">3.</span> <span class="nav-text">Closure</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jack Chen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">170</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Chen</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
