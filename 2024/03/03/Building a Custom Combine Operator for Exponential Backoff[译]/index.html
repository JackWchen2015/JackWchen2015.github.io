<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Make your Combine code reusable åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å‘ä½ å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Combineæ¥æ”¹å–„Combineç®¡é“çš„é”™è¯¯å¤„ç†ï¼Œå¹¶ä»¥ä¸€ç§å¯¹ç”¨æˆ·æœ‰æ„ä¹‰çš„æ–¹å¼æš´éœ²SwiftUIåº”ç”¨ä¸­çš„é”™è¯¯ã€‚  ä¸å‡ºæ‰€æ–™ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ä»£ç çœ‹èµ·æ¥æ¯”å¼€å§‹æ—¶è¦å¤æ‚ä¸€äº›ã€‚æ­£ç¡®å¤„ç†é”™è¯¯æ¯”å®Œå…¨ä¸å¤„ç†é”™è¯¯(æˆ–å¿½ç•¥é”™è¯¯)å ç”¨æ›´å¤šçš„ä»£ç è¡Œã€‚  ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½!  åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½ å°†äº†è§£Combineæ“ä½œç¬¦:">
<meta property="og:type" content="article">
<meta property="og:title" content="Building a Custom Combine Operator for Exponential Backoff[è¯‘]">
<meta property="og:url" content="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2024/03/03/Building%20a%20Custom%20Combine%20Operator%20for%20Exponential%20Backoff[%E8%AF%91]/index.html">
<meta property="og:site_name" content="å­¦è®¡ç®—æœºçš„é‚£ä¸ª">
<meta property="og:description" content="Make your Combine code reusable åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å‘ä½ å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Combineæ¥æ”¹å–„Combineç®¡é“çš„é”™è¯¯å¤„ç†ï¼Œå¹¶ä»¥ä¸€ç§å¯¹ç”¨æˆ·æœ‰æ„ä¹‰çš„æ–¹å¼æš´éœ²SwiftUIåº”ç”¨ä¸­çš„é”™è¯¯ã€‚  ä¸å‡ºæ‰€æ–™ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ä»£ç çœ‹èµ·æ¥æ¯”å¼€å§‹æ—¶è¦å¤æ‚ä¸€äº›ã€‚æ­£ç¡®å¤„ç†é”™è¯¯æ¯”å®Œå…¨ä¸å¤„ç†é”™è¯¯(æˆ–å¿½ç•¥é”™è¯¯)å ç”¨æ›´å¤šçš„ä»£ç è¡Œã€‚  ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½!  åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½ å°†äº†è§£Combineæ“ä½œç¬¦:">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-03-02T16:00:00.000Z">
<meta property="article:modified_time" content="2024-05-25T08:02:28.131Z">
<meta property="article:author" content="Jack Chen">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2024/03/03/Building%20a%20Custom%20Combine%20Operator%20for%20Exponential%20Backoff[%E8%AF%91]/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Building a Custom Combine Operator for Exponential Backoff[è¯‘] | å­¦è®¡ç®—æœºçš„é‚£ä¸ª</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">å­¦è®¡ç®—æœºçš„é‚£ä¸ª</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸æ˜¯æˆ‘è§‰åˆ°ã€æ‚Ÿåˆ°ï¼Œä½ ç»™ä¸äº†æˆ‘ï¼Œç»™äº†ä¹Ÿæ‹¿ä¸ä½;åªæœ‰æˆ‘è§‰åˆ°ã€æ‚Ÿåˆ°ï¼Œæ‰æœ‰å¯èƒ½åšåˆ°ï¼Œèƒ½åšåˆ°çš„æ‰æ˜¯æˆ‘çš„.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/JackWchen2015/JackWchen2015.github.io.git/2024/03/03/Building%20a%20Custom%20Combine%20Operator%20for%20Exponential%20Backoff[%E8%AF%91]/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jack Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å­¦è®¡ç®—æœºçš„é‚£ä¸ª">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Building a Custom Combine Operator for Exponential Backoff[è¯‘]
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-03-03 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-03T00:00:00+08:00">2024-03-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-25 16:02:28" itemprop="dateModified" datetime="2024-05-25T16:02:28+08:00">2024-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/SwiftUI/" itemprop="url" rel="index"><span itemprop="name">SwiftUI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Make your Combine code reusable</p>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å‘ä½ å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Combineæ¥æ”¹å–„Combineç®¡é“çš„é”™è¯¯å¤„ç†ï¼Œå¹¶ä»¥ä¸€ç§å¯¹ç”¨æˆ·æœ‰æ„ä¹‰çš„æ–¹å¼æš´éœ²SwiftUIåº”ç”¨ä¸­çš„é”™è¯¯ã€‚ </p>
<p>ä¸å‡ºæ‰€æ–™ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ä»£ç çœ‹èµ·æ¥æ¯”å¼€å§‹æ—¶è¦å¤æ‚ä¸€äº›ã€‚æ­£ç¡®å¤„ç†é”™è¯¯æ¯”å®Œå…¨ä¸å¤„ç†é”™è¯¯(æˆ–å¿½ç•¥é”™è¯¯)å ç”¨æ›´å¤šçš„ä»£ç è¡Œã€‚ </p>
<p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½! </p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½ å°†äº†è§£Combineæ“ä½œç¬¦:å®ƒä»¬æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå¦‚ä½•å°†æˆ‘ä»¬çš„ä»£ç é‡æ„æˆä¸€ä¸ªè‡ªå®šä¹‰çš„Combineæ“ä½œç¬¦ï¼Œä»è€Œä½¿å…¶æ›´å®¹æ˜“æ¨ç†(reason about)ï¼ŒåŒæ—¶æ›´æ˜“äºé‡ç”¨ã€‚</p>
<span id="more"></span>

<h1 id="What-is-a-Combine-Operator"><a href="#What-is-a-Combine-Operator" class="headerlink" title="What is a Combine Operator?"></a>What is a Combine Operator?</h1><p>Combineå®šä¹‰äº†ä¸‰ä¸ªä¸»è¦æ¦‚å¿µæ¥å®ç°å“åº”å¼ç¼–ç¨‹çš„æ€æƒ³: </p>
<ol>
<li>Publishers</li>
<li>Subscribers</li>
<li>Operators</li>
</ol>
<p>å‘å¸ƒè€…éšç€æ—¶é—´çš„æ¨ç§»äº¤ä»˜<code>values </code>ï¼Œè®¢é˜…è€…åœ¨æ”¶åˆ°è¿™äº›<code>values </code>æ—¶é‡‡å–è¡ŒåŠ¨ã€‚<code>Operators</code>ä½äºå‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´ï¼Œå¯ä»¥ç”¨æ¥æ“çºµ(manipulate)æ•°æ®æµ(stream of values)ã€‚ </p>
<p>æˆ‘ä»¬éœ€è¦æ“ä½œç¬¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› :</p>
<ul>
<li><p>å‘å¸ƒè€…å¹¶ä¸æ€»æ˜¯ä»¥è®¢é˜…è€…æ‰€éœ€çš„æ ¼å¼ç”Ÿæˆäº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œå‘å¸ƒè€…å¯èƒ½ä¼šå‘å‡º<code>HTTP</code>ç½‘ç»œè¯·æ±‚çš„ç»“æœï¼Œä½†è®¢é˜…è€…éœ€è¦è‡ªå®šä¹‰æ•°æ®ç»“æ„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨<code>map</code>æˆ–<code>decode</code>ç­‰æ“ä½œç¬¦å°†å‘å¸ƒè€…çš„è¾“å‡ºè½¬æ¢ä¸ºè®¢é˜…è€…æœŸæœ›çš„æ•°æ®ç»“æ„ã€‚ </p>
</li>
<li><p>å‘å¸ƒè€…å¯èƒ½ä¼šç”Ÿæˆè®¢é˜…è€…ä¸æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œå½“è¾“å…¥ä¸€ä¸ªæœç´¢è¯æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½å¯¹æ¯ä¸€æ¬¡å‡»é”®éƒ½ä¸æ„Ÿå…´è¶£ï¼Œè€Œåªå¯¹æœ€åçš„æœç´¢è¯æ„Ÿå…´è¶£ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>debounce</code>æˆ–<code>throttle</code>ä¹‹ç±»çš„æ“ä½œç¬¦æ¥å‡å°‘è®¢é˜…è€…å¿…é¡»å¤„ç†çš„äº‹ä»¶æ•°é‡ã€‚</p>
</li>
</ul>
<p>æ“ä½œç¬¦å¸®åŠ©æˆ‘ä»¬è·å–å‘å¸ƒè€…äº§ç”Ÿçš„è¾“å‡ºï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºè®¢é˜…è€…å¯ä»¥æ¶ˆè´¹çš„ä¸œè¥¿ã€‚åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ä¸€äº›å†…ç½®æ“ä½œç¬¦ï¼Œä¾‹å¦‚: </p>
<ul>
<li><code>map</code>(ä»¥åŠå®ƒçš„æœ‹å‹ï¼Œ<code>tryMap</code>)æ¥è½¬æ¢å…ƒç´  </li>
<li><code>debounce</code>åªåœ¨ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´æš‚åœä¹‹åæ‰å‘å¸ƒå…ƒç´  </li>
<li><code>removeduplates</code>åˆ é™¤é‡å¤äº‹ä»¶ </li>
<li><code>flatMap</code>å°†å…ƒç´ è½¬æ¢ä¸ºæ–°çš„å‘å¸ƒè€…</li>
</ul>
<h1 id="How-can-we-implement-a-custom-operator"><a href="#How-can-we-implement-a-custom-operator" class="headerlink" title="How can we implement a custom operator?"></a>How can we implement a custom operator?</h1><p>é€šå¸¸ï¼Œåœ¨åˆ›å»º<code>Combine</code>ç®¡é“æ—¶ï¼Œæˆ‘ä»¬å°†ä»ä¸€ä¸ªå‘å¸ƒè€…å¼€å§‹ï¼Œç„¶åè¿æ¥ä¸€å †<code>Combine</code>çš„å†…ç½®æ“ä½œç¬¦æ¥å¤„ç†å‘å¸ƒè€…å‘å‡ºçš„äº‹ä»¶ã€‚ä»»ä½•Combineç®¡é“çš„æœ«ç«¯éƒ½æ˜¯æ¥æ”¶äº‹ä»¶çš„è®¢é˜…è€…ã€‚æ­£å¦‚ä½ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„ï¼Œç®¡é“å¾ˆå¿«å°±ä¼šå˜å¾—å¤æ‚ã€‚ </p>
<p>ä»æŠ€æœ¯ä¸Šè®²ï¼Œ<strong>æ“ä½œç¬¦åªæ˜¯åˆ›å»ºå…¶ä»–å‘å¸ƒè€…å’Œè®¢é˜…è€…çš„å‡½æ•°ï¼Œè¿™äº›å‘å¸ƒè€…å’Œè®¢é˜…è€…å¤„ç†ä»ä¸Šæ¸¸å‘å¸ƒè€…æ¥æ”¶åˆ°çš„äº‹ä»¶</strong>ã€‚ </p>
<p>è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨è¿”å›å‘å¸ƒè€…(æˆ–è®¢é˜…è€…)çš„å‡½æ•°æ¥æ‰©å±•<code>Publisher</code>æ¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æ“ä½œç¬¦ï¼Œè¯¥å‘å¸ƒè€…(æˆ–è®¢é˜…è€…)å¯¹ä»ä½¿ç”¨å®ƒçš„å‘å¸ƒè€…æ¥æ”¶åˆ°çš„äº‹ä»¶è¿›è¡Œæ“ä½œã€‚ </p>
<p>è®©æˆ‘ä»¬é€šè¿‡å®ç°ä¸€ä¸ªç®€å•çš„æ“ä½œç¬¦æ¥çœ‹çœ‹è¿™åœ¨å®è·µä¸­æ„å‘³ç€ä»€ä¹ˆï¼Œè¿™ä¸ªæ“ä½œç¬¦å…è®¸æˆ‘ä»¬ä½¿ç”¨Swiftçš„<code>dump()</code>å‡½æ•°æ¥æ£€æŸ¥<code>merge</code>ç®¡é“ä¸­çš„äº‹ä»¶ã€‚è¿™ä¸ªå‡½æ•°å°†å˜é‡çš„å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ï¼Œå¹¶ä»¥åµŒå¥—æ ‘çš„å½¢å¼æ˜¾ç¤ºå˜é‡çš„ç»“æ„â€”â€”ç±»ä¼¼äºXcodeä¸­çš„è°ƒè¯•æ£€æŸ¥å™¨ã€‚</p>
<p>ç°åœ¨ï¼Œæ‚¨å¯èƒ½çŸ¥é“<code>Combine</code>çš„<code>print()</code>æ“ä½œç¬¦ï¼Œå®ƒçš„å·¥ä½œåŸç†éå¸¸ç›¸ä¼¼ã€‚ä½†æ˜¯ï¼Œå®ƒæ²¡æœ‰æä¾›è¶³å¤Ÿçš„ç»†èŠ‚ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæ²¡æœ‰å°†ç»“æœæ˜¾ç¤ºä¸ºåµŒå¥—ç»“æ„ã€‚ </p>
<p>è¦æ·»åŠ æ“ä½œç¬¦ï¼Œé¦–å…ˆéœ€è¦å‘<code>Publisher</code>ç±»å‹æ·»åŠ æ‰©å±•ã€‚ç”±äºæˆ‘ä»¬ä¸æƒ³æ“ä½œæ­¤æ“ä½œç¬¦æ¥æ”¶åˆ°çš„äº‹ä»¶ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šæ¸¸å‘å¸ƒè€…çš„ç±»å‹ä½œä¸ºç»“æœç±»å‹ï¼Œå¹¶è¿”å›<code>AnypPublisher&lt;Self.Output, Self.Failure&gt;</code>ä½œä¸ºç»“æœç±»å‹:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Publisher</span> &#123;</span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">dump</span>() -&gt; <span class="type">AnyPublisher</span>&lt;<span class="keyword">Self</span>.<span class="type">Output</span>, <span class="keyword">Self</span>.<span class="type">Failure</span>&gt; &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>handleEvents</code>æ“ä½œç¬¦æ£€æŸ¥è¯¥ç®¡é“å¤„ç†çš„ä»»ä½•äº‹ä»¶ã€‚<code>handleEvents</code>æœ‰ä¸€å †å¯é€‰é—­åŒ…ï¼Œå½“å‘å¸ƒè€…æ¥æ”¶åˆ°æ–°çš„è®¢é˜…ã€æ–°çš„è¾“å‡ºå€¼ã€å–æ¶ˆäº‹ä»¶ã€å®Œæˆè®¢é˜…æˆ–è®¢é˜…è€…è¯·æ±‚æ›´å¤šå…ƒç´ æ—¶ï¼Œä¼šè°ƒç”¨è¿™äº›é—­åŒ…ã€‚ç”±äºæˆ‘ä»¬åªå¯¹æ–°çš„<code>Output</code>å€¼æ„Ÿå…´è¶£ï¼Œå› æ­¤å¯ä»¥å¿½ç•¥å¤§å¤šæ•°é—­åŒ…ï¼Œåªå®ç°<code>receiveOutput</code>é—­åŒ…ã€‚ </p>
<p>æ¯å½“æˆ‘ä»¬æ¥æ”¶åˆ°ä¸€ä¸ªå€¼æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Swiftçš„<code>dump()</code>å‡½æ•°å°†å€¼çš„å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Publisher</span> &#123;</span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">dump</span>() -&gt; <span class="type">AnyPublisher</span>&lt;<span class="keyword">Self</span>.<span class="type">Output</span>, <span class="keyword">Self</span>.<span class="type">Failure</span>&gt; &#123;</span><br><span class="line">    handleEvents(receiveOutput:  &#123; value <span class="keyword">in</span></span><br><span class="line">      <span class="type">Swift</span>.dump(value)</span><br><span class="line">    &#125;)</span><br><span class="line">    .eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥åƒä½¿ç”¨Combineçš„ä»»ä½•å†…ç½®æ“ä½œç¬¦ä¸€æ ·ä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ–°æ“ä½œç¬¦é™„åŠ åˆ°ä¸€ä¸ªå‘å‡ºå½“å‰æ—¥æœŸçš„ç®€å•å‘å¸ƒè€…:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Just</span>(<span class="type">Date</span>())</span><br><span class="line">  .dump()</span><br><span class="line"> </span><br><span class="line"><span class="comment">// prints:</span></span><br><span class="line"> </span><br><span class="line"><span class="operator">â–¿</span> <span class="number">2022</span><span class="operator">-</span><span class="number">03</span><span class="operator">-</span><span class="number">02</span> <span class="number">09</span>:<span class="number">38</span>:<span class="number">49</span> <span class="operator">+</span><span class="number">0000</span></span><br><span class="line">  <span class="operator">-</span> timeIntervalSinceReferenceDate: <span class="number">667906729.659255</span></span><br></pre></td></tr></table></figure>

<h1 id="Implementing-a-retry-operator-with-a-delay"><a href="#Implementing-a-retry-operator-with-a-delay" class="headerlink" title="Implementing a retry operator with a delay"></a>Implementing a retry operator with a delay</h1><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»å¯¹å¦‚ä½•å®ç°åŸºæœ¬è¿ç®—ç¬¦æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥é‡æ„ä¸Šä¸€é›†çš„ä»£ç ã€‚ä»¥ä¸‹æ˜¯ç›¸å…³éƒ¨åˆ†:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> dataTaskPublisher</span><br><span class="line">  .tryCatch &#123; error -&gt; <span class="type">AnyPublisher</span>&lt;(data: <span class="type">Data</span>, response: <span class="type">URLResponse</span>), <span class="type">Error</span>&gt; <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">case</span> <span class="type">APIError</span>.serverError <span class="operator">=</span> error &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">Just</span>(<span class="type">Void</span>())</span><br><span class="line">        .delay(for: <span class="number">3</span>, scheduler: <span class="type">DispatchQueue</span>.global())</span><br><span class="line">        .flatMap &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">          <span class="keyword">return</span> dataTaskPublisher</span><br><span class="line">        &#125;</span><br><span class="line">        .print(<span class="string">&quot;before retry&quot;</span>)</span><br><span class="line">        .retry(<span class="number">10</span>)</span><br><span class="line">        .eraseToAnyPublisher()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> error</span><br><span class="line">  &#125;</span><br><span class="line">  .map(\.data)</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬é¦–å…ˆä¸º<code>Publisher</code>ä¸Šçš„é‡è¯•æ“ä½œç¬¦æ„é€ ä¸€ä¸ªé‡è½½æ‰©å±•:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Publisher</span> &#123;</span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">retry</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt;(<span class="keyword">_</span> <span class="params">retries</span>: <span class="type">Int</span>, <span class="params">withDelay</span> <span class="params">delay</span>: <span class="type">Int</span>) </span><br><span class="line">    -&gt; <span class="type">Publishers</span>.<span class="type">TryCatch</span>&lt;<span class="keyword">Self</span>, <span class="type">AnyPublisher</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt;&gt; </span><br><span class="line">       <span class="keyword">where</span> <span class="type">T</span> <span class="operator">==</span> <span class="keyword">Self</span>.<span class="type">Output</span>, <span class="type">E</span> <span class="operator">==</span> <span class="keyword">Self</span>.<span class="type">Failure</span> </span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å®šä¹‰äº†ä¸¤ä¸ªè¾“å…¥å‚æ•°ï¼Œ<code>retries</code>å’Œ<code>withDelay</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æŒ‡å®šåº”è¯¥é‡è¯•å¤šå°‘æ¬¡ä¸Šæ¸¸å‘å¸ƒè€…ï¼Œä»¥åŠæ¯æ¬¡é‡è¯•ä¹‹é—´åº”è¯¥å‰©ä¸‹å¤šå°‘æ—¶é—´(ä»¥ç§’ä¸ºå•ä½)ã€‚ </p>
<p>ç”±äºè¦åœ¨æ–°æ“ä½œç¬¦ä¸­ä½¿ç”¨<code>tryCatch</code>æ“ä½œç¬¦ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å®ƒçš„å‘å¸ƒè€…ç±»å‹<code>Publishers</code>ã€‚å°†<code>TryCatch</code>ä½œä¸ºè¿”å›ç±»å‹ã€‚ </p>
<p>æœ‰äº†è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡ç²˜è´´ç°æœ‰çš„å®ç°æ¥å®ç°æ“ä½œç¬¦çš„ä¸»ä½“:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Publisher</span> &#123;</span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">retry</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt;(<span class="keyword">_</span> <span class="params">retries</span>: <span class="type">Int</span>, <span class="params">withDelay</span> <span class="params">delay</span>: <span class="type">Int</span>) </span><br><span class="line">    -&gt; <span class="type">Publishers</span>.<span class="type">TryCatch</span>&lt;<span class="keyword">Self</span>, <span class="type">AnyPublisher</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt;&gt; </span><br><span class="line">       <span class="keyword">where</span> <span class="type">T</span> <span class="operator">==</span> <span class="keyword">Self</span>.<span class="type">Output</span>, <span class="type">E</span> <span class="operator">==</span> <span class="keyword">Self</span>.<span class="type">Failure</span> </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.tryCatch &#123; error -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt; <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">return</span> <span class="type">Just</span>(<span class="type">Void</span>())</span><br><span class="line">        .delay(for: .<span class="keyword">init</span>(integerLiteral: delay), scheduler: <span class="type">DispatchQueue</span>.global())</span><br><span class="line">        .flatMap &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">        &#125;</span><br><span class="line">        .retry(retries)</span><br><span class="line">        .eraseToAnyPublisher()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘ä»¬åˆ é™¤äº†é”™è¯¯æ£€æŸ¥ã€‚è¿™æ˜¯å› ä¸º<code>APIError</code>æ˜¯ç‰¹å®šäºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„é”™è¯¯ç±»å‹ã€‚å› ä¸ºæˆ‘ä»¬æœ‰å…´è¶£è®©è¿™ä¸ªå®ç°ä¹Ÿå¯ä»¥åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿å®ƒæ›´çµæ´»ã€‚</p>
<h1 id="Conditionally-retrying"><a href="#Conditionally-retrying" class="headerlink" title="Conditionally retrying"></a>Conditionally retrying</h1><p>ä¸ºäº†ä½¿æ­¤ä»£ç åœ¨å…¶ä»–ä¸Šä¸‹æ–‡ä¸­å¯é‡ç”¨ï¼Œè®©æˆ‘ä»¬ä¸ºæœ«å°¾é—­åŒ…(trailing closure)æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œè°ƒç”¨è€…å¯ä»¥ä½¿ç”¨è¯¥å‚æ•°æ¥æ§åˆ¶æ“ä½œç¬¦æ˜¯å¦åº”è¯¥é‡è¯•ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">retry</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt;(<span class="keyword">_</span> <span class="params">retries</span>: <span class="type">Int</span>, <span class="params">withDelay</span> <span class="params">delay</span>: <span class="type">Int</span>, <span class="params">condition</span>: ((<span class="type">E</span>) -&gt; <span class="type">Bool</span>)<span class="operator">?</span> <span class="operator">=</span> <span class="literal">nil</span>) -&gt; <span class="type">Publishers</span>.<span class="type">TryCatch</span>&lt;<span class="keyword">Self</span>, <span class="type">AnyPublisher</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt;&gt; <span class="keyword">where</span> <span class="type">T</span> <span class="operator">==</span> <span class="keyword">Self</span>.<span class="type">Output</span>, <span class="type">E</span> <span class="operator">==</span> <span class="keyword">Self</span>.<span class="type">Failure</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">self</span>.tryCatch &#123; error -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt; <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> condition<span class="operator">?</span>(error) <span class="operator">==</span> <span class="literal">true</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">Just</span>(<span class="type">Void</span>())</span><br><span class="line">        .delay(for: .<span class="keyword">init</span>(integerLiteral: delay), scheduler: <span class="type">DispatchQueue</span>.global())</span><br><span class="line">        .flatMap &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">        &#125;</span><br><span class="line">        .retry(retries)</span><br><span class="line">        .eraseToAnyPublisher()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> error</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè°ƒç”¨è€…æ²¡æœ‰æä¾›é—­åŒ…ï¼Œæ“ä½œç¬¦å°†ä½¿ç”¨å‚æ•°é‡è¯•å’Œå»¶è¿Ÿé‡è¯•ã€‚ </p>
<p>æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–åŸæ¥çš„è°ƒç”¨:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">return</span> dataTaskPublisher</span><br><span class="line">  .retry(<span class="number">10</span>, withDelay: <span class="number">3</span>) &#123; error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">case</span> <span class="type">APIError</span>.serverError <span class="operator">=</span> error &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  .map(\.data)</span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<h1 id="Implementing-a-retry-operator-for-exponential-backoff"><a href="#Implementing-a-retry-operator-for-exponential-backoff" class="headerlink" title="Implementing a retry operator for exponential backoff"></a>Implementing a retry operator for exponential backoff</h1><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´è¿›ä¸€æ­¥ï¼Œå®ç°ä¸€ä¸ªå¸¦æœ‰æŒ‡æ•°å›é€€(exponential back-off)çš„é‡è¯•æ“ä½œç¬¦ã€‚ </p>
<blockquote>
<p>æŒ‡æ•°å›é€€é€šå¸¸ç”¨ä½œç½‘ç»œæœåŠ¡ç­‰è®¡ç®—æœºç³»ç»Ÿä¸­é€Ÿç‡é™åˆ¶æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œä»¥å¸®åŠ©å¼ºåˆ¶å…¬å¹³åˆ†é…å¯¹èµ„æºçš„è®¿é—®å¹¶é˜²æ­¢ç½‘ç»œæ‹¥å¡ã€‚(ç»´åŸºç™¾ç§‘) </p>
</blockquote>
<p>ä¸ºäº†å¢åŠ ä¸¤ä¸ªè¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªä¿å­˜å½“å‰é—´éš”çš„å±€éƒ¨å˜é‡ï¼Œå¹¶åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹åå°†å…¶åŠ å€ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°†å¯åŠ¨åŸå§‹ç®¡é“çš„å†…éƒ¨ç®¡é“åŒ…è£…åœ¨ä¸€ä¸ªå¢åŠ <code>backoff</code>å˜é‡çš„ç®¡é“ä¸­:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">retry</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt;(<span class="keyword">_</span> <span class="params">retries</span>: <span class="type">Int</span>, </span><br><span class="line">                 <span class="params">withBackoff</span> <span class="params">initialBackoff</span>: <span class="type">Int</span>, </span><br><span class="line">                 <span class="params">condition</span>: ((<span class="type">E</span>) -&gt; <span class="type">Bool</span>)<span class="operator">?</span> <span class="operator">=</span> <span class="literal">nil</span>) </span><br><span class="line">    -&gt; <span class="type">Publishers</span>.<span class="type">TryCatch</span>&lt;<span class="keyword">Self</span>, <span class="type">AnyPublisher</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt;&gt; </span><br><span class="line">    <span class="keyword">where</span> <span class="type">T</span> <span class="operator">==</span> <span class="keyword">Self</span>.<span class="type">Output</span>, <span class="type">E</span> <span class="operator">==</span> <span class="keyword">Self</span>.<span class="type">Failure</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">self</span>.tryCatch &#123; error -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt; <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> condition<span class="operator">?</span>(error) <span class="operator">??</span> <span class="literal">true</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> backOff <span class="operator">=</span> initialBackoff</span><br><span class="line">      <span class="keyword">return</span> <span class="type">Just</span>(<span class="type">Void</span>())</span><br><span class="line">        .flatMap &#123; <span class="keyword">_</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt; <span class="keyword">in</span></span><br><span class="line">          <span class="keyword">let</span> result <span class="operator">=</span> <span class="type">Just</span>(<span class="type">Void</span>())</span><br><span class="line">            .delay(for: .<span class="keyword">init</span>(integerLiteral: backOff), scheduler: <span class="type">DispatchQueue</span>.global())</span><br><span class="line">            .flatMap &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">            &#125;</span><br><span class="line">          backOff <span class="operator">=</span> backOff <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">          <span class="keyword">return</span> result.eraseToAnyPublisher()</span><br><span class="line">        &#125;</span><br><span class="line">        .retry(retries <span class="operator">-</span> <span class="number">1</span>)</span><br><span class="line">        .eraseToAnyPublisher()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> error</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä»…å¯¹æŸäº›ç±»å‹çš„é”™è¯¯ä½¿ç”¨æŒ‡æ•°å›é€€ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°é—­åŒ…æ¥æ£€æŸ¥é”™è¯¯ï¼Œå°±åƒä»¥å‰ä¸€æ ·ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªä»£ç ç‰‡æ®µï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å¢é‡åé€€ä¸3ç§’çš„åˆå§‹é—´éš”ä¸ºä»»ä½•<code>APIError.serverError</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> dataTaskPublisher</span><br><span class="line">  .retry(<span class="number">2</span>, withBackoff: <span class="number">3</span>) &#123; error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">case</span> <span class="type">APIError</span>.serverError(<span class="keyword">_</span>, <span class="keyword">_</span>, <span class="keyword">_</span>) <span class="operator">=</span> error &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä½¿ç”¨æŒ‡æ•°å›é€€è€Œä¸è€ƒè™‘é”™è¯¯ï¼Œè¿™å˜å¾—æ›´åŠ ç´§å‡‘(compact):</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> dataTaskPublisher</span><br><span class="line">  .retry(<span class="number">2</span>, withIncrementalBackoff: <span class="number">3</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<h1 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h1><p>Combineæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ¡†æ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä¸ºåº”ç”¨ç¨‹åºç»„åˆéå¸¸é«˜æ•ˆçš„æ•°æ®å’Œäº‹ä»¶å¤„ç†ç®¡é“ã€‚ </p>
<p>æœ‰æ—¶ï¼Œè¿™ç§èƒ½åŠ›æ˜¯æœ‰ä»£ä»·çš„:åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå¼ºå¤§çš„é”™è¯¯å¤„ç†ç®¡é“ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥æ¯”åŸå§‹ç‰ˆæœ¬æ›´å¤æ‚ï¼ŒåŸå§‹ç‰ˆæœ¬ä½¿ç”¨Combineçš„å†…ç½®æ“ä½œç¬¦æ¥å¤„ç†é”™è¯¯ï¼Œå°†å®ƒä»¬æ›¿æ¢ä¸ºå®Œå…¨å¿½ç•¥å®ƒä»¬çš„é»˜è®¤å€¼ã€‚ </p>
<p>åœ¨è¿™ä¸€é›†ä¸­ï¼Œæ‚¨çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ“ä½œç¬¦æ¥é‡æ„ä»£ç ã€‚ </p>
<p>ç”±äºCombineçµæ´»çš„è®¾è®¡ï¼Œåˆ›å»ºè‡ªå®šä¹‰æ“ä½œç¬¦ä¸éœ€è¦ç¼–å†™å¤§é‡ä»£ç ï¼Œå¹¶ä¸”æœ‰åŠ©äºä½¿æˆ‘ä»¬çš„ä»£ç æ›´å…·å¯è¯»æ€§å’Œå¯é‡ç”¨æ€§ã€‚ </p>
<p>æ„Ÿè°¢é˜…è¯»ğŸ”¥</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/03/02/Error%20Handling%20with%20Combine%20and%20SwiftUI%20%5B%E8%AF%91%5D%20/" rel="prev" title="Error Handling with Combine and SwiftUI [è¯‘]">
      <i class="fa fa-chevron-left"></i> Error Handling with Combine and SwiftUI [è¯‘]
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/04/15/Swift%E8%8A%B1%E5%9B%AD%E7%AC%94%E8%AE%B0%20-%20%E6%9E%81%E9%80%9FSwift%E6%95%99%E7%A8%8B/" rel="next" title="SwiftèŠ±å›­ç¬”è®° -  æé€ŸSwiftæ•™ç¨‹">
      SwiftèŠ±å›­ç¬”è®° -  æé€ŸSwiftæ•™ç¨‹ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#What-is-a-Combine-Operator"><span class="nav-number">1.</span> <span class="nav-text">What is a Combine Operator?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#How-can-we-implement-a-custom-operator"><span class="nav-number">2.</span> <span class="nav-text">How can we implement a custom operator?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Implementing-a-retry-operator-with-a-delay"><span class="nav-number">3.</span> <span class="nav-text">Implementing a retry operator with a delay</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conditionally-retrying"><span class="nav-number">4.</span> <span class="nav-text">Conditionally retrying</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Implementing-a-retry-operator-for-exponential-backoff"><span class="nav-number">5.</span> <span class="nav-text">Implementing a retry operator for exponential backoff</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Closure"><span class="nav-number">6.</span> <span class="nav-text">Closure</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jack Chen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">176</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Chen</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
